(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7ae9413d"],{"2caf":function(e,t,a){"use strict";a("ecca")},7552:function(e,t,a){},"7aa3":function(e,t,a){"use strict";a("7e30")},"7e30":function(e,t,a){},aa9e:function(e,t,a){"use strict";a("7552")},ecca:function(e,t,a){},fa63:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e.$route.meta.showOriginalContent?t("div",{staticClass:"opTab"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,"label-width":"68px"}},[t("el-form-item",{attrs:{label:"任务名称"}},[t("el-autocomplete",{staticClass:"autoinput",attrs:{clearable:"","fetch-suggestions":e.querySearchTask,placeholder:"请输入任务名称"},on:{select:e.handleSelectTask},model:{value:e.formInline.taskName,callback:function(t){e.$set(e.formInline,"taskName",t)},expression:"formInline.taskName"}})],1),t("el-form-item",{attrs:{label:"任务类型"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择任务类型"},model:{value:e.formInline.taskType,callback:function(t){e.$set(e.formInline,"taskType",t)},expression:"formInline.taskType"}},e._l(e.taskTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"关联模型"}},[t("el-autocomplete",{staticClass:"autoinput",attrs:{clearable:"","fetch-suggestions":e.querySearch,placeholder:"请输入关联模型"},on:{select:e.handleSelect},model:{value:e.formInline.proccnname,callback:function(t){e.$set(e.formInline,"proccnname",t)},expression:"formInline.proccnname"}})],1),t("el-form-item",{attrs:{label:"模型类型"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择模型类型"},model:{value:e.formInline.proctype,callback:function(t){e.$set(e.formInline,"proctype",t)},expression:"formInline.proctype"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"任务状态"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择状态"},model:{value:e.formInline.state,callback:function(t){e.$set(e.formInline,"state",t)},expression:"formInline.state"}},e._l(e.taskOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"时间选择"}},[t("el-date-picker",{staticClass:"datePicker",attrs:{"picker-options":e.pickerOptions,"unlink-panels":"",clearable:!1,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.formInline.dateRange,callback:function(t){e.$set(e.formInline,"dateRange",t)},expression:"formInline.dateRange"}})],1),t("el-form-item",{attrs:{label:"创建人"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入创建人"},model:{value:e.formInline.curdutyer,callback:function(t){e.$set(e.formInline,"curdutyer",t)},expression:"formInline.curdutyer"}})],1),t("el-form-item"),t("el-form-item"),t("el-form-item")],1),t("div",{staticStyle:{"text-align":"end","margin-top":"20px","padding-right":"5px"}},[t("div",{staticClass:"btnTab"},[t("el-button",{attrs:{type:"primary",size:"medium",loading:e.getLoading},on:{click:e.onSubmit}},[e._v("查询")]),t("el-button",{attrs:{size:"medium"},on:{click:e.resetList}},[e._v("重置")])],1)]),t("div",{staticClass:"btnTT"},[t("div",{staticClass:"outputTab"},[t("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.addNew}},[e._v("新增")])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.getLoading,expression:"getLoading"}],ref:"tables",staticClass:"pb15 listTable",attrs:{data:e.list,height:e.tableHeight,"default-sort":{prop:"createAt",order:"descending"}},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{label:"序号",type:"index",width:"50"}}),t("el-table-column",{attrs:{label:"任务编号",align:"center",width:"250",prop:"taskCode"}}),t("el-table-column",{attrs:{label:"任务名称",align:"center",prop:"taskName"}}),t("el-table-column",{attrs:{label:"任务类型",align:"center",prop:"taskType",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.taskTy(t.row)))]}}],null,!1,3232393938)}),t("el-table-column",{attrs:{label:"任务描述",align:"center",prop:"taskDescription"}}),t("el-table-column",{attrs:{label:"关联模型",align:"center",prop:"proc.proccnname",width:"150"}}),t("el-table-column",{attrs:{label:"创建人",align:"center",prop:"createUserName"}}),t("el-table-column",{attrs:{label:"创建时间",align:"center",width:"200",prop:"createAt"}}),t("el-table-column",{attrs:{label:"状态",align:"center",width:"100",prop:"taskStatus"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.taskSt(t.row)))]}}],null,!1,2864968376)}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.startOrStopTask(a.row)}}},[e._v(e._s("1"===a.row.taskStatus?"停止":"启动"))]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.goCustom(a.row)}}},[e._v("查看")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.edit(a.row,a)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.del(a.row,a)}}},[e._v("删除")]),t("el-dropdown",{staticStyle:{"margin-left":"10px"},attrs:{slot:"dropdown",trigger:"click"},on:{command:e.handleCommand},slot:"dropdown"},[t("el-button",{attrs:{size:"mini",type:"text"}},[e._v("更多")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:e.beforeHandleCommand(a.$index,a.row,"a")}},[e._v("查看运行历史")]),t("el-dropdown-item",{attrs:{command:e.beforeHandleCommand(a.$index,a.row,"b")}},[e._v("结果分析")]),t("el-dropdown-item",{attrs:{command:e.beforeHandleCommand(a.$index,a.row,"c")}},[e._v("手动执行")])],1)],1)]}}],null,!1,1493909631)})],1),t("div",{staticClass:"main-content-footer"},[t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],staticStyle:{"text-align":"end"},attrs:{total:e.total,"page-size":e.pageSize,"current-page":e.pageNum},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t},"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{visible:e.deleteVisible,width:"30%"},on:{"update:visible":function(t){e.deleteVisible=t}}},[t("div",{staticStyle:{"font-size":"16px"},attrs:{slot:"title"},slot:"title"},[t("i",{staticClass:"el-icon-warning",staticStyle:{color:"rgb(250, 173, 20)"}}),e._v("删除数据 ")]),t("span",[e._v("确认后此条数据将被彻底，无法找回。")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"medium"},on:{click:function(t){e.deleteVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.confirmDel}},[e._v("确 定")])],1)]),t("addTask",{ref:"addTask",on:{confirmChose:e.confirm}})],1):t("div",[t("router-view")],1)])},l=[],s=(a("14d9"),a("cf45")),o=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"diaglog",attrs:{title:e.dialogData.title,visible:e.dialogData.visible},on:{"update:visible":function(t){return e.$set(e.dialogData,"visible",t)}}},[t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{staticClass:"sample",attrs:{label:"任务名称",prop:"taskName","label-width":e.formLabelWidth}},[t("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.form.taskName,callback:function(t){e.$set(e.form,"taskName",t)},expression:"form.taskName"}})],1),t("el-form-item",{staticClass:"sample",attrs:{label:"任务描述","label-width":e.formLabelWidth}},[t("el-input",{attrs:{rows:4,placeholder:"请输入任务描述",type:"textarea"},model:{value:e.form.taskDescription,callback:function(t){e.$set(e.form,"taskDescription",t)},expression:"form.taskDescription"}})],1),t("el-form-item",{staticClass:"sample",attrs:{label:"选择模型",prop:"procName","label-width":e.formLabelWidth}},[t("el-input",{attrs:{readonly:"",placeholder:"请选择模型"},nativeOn:{click:function(t){e.innerVisible=!0}},model:{value:e.form.procName,callback:function(t){e.$set(e.form,"procName",t)},expression:"form.procName"}})],1),t("el-form-item",{staticClass:"sample",staticStyle:{cursor:"pointer"},attrs:{label:"Corn表达式","label-width":e.formLabelWidth,prop:"taskCorn"}},[t("el-input",{attrs:{"suffix-icon":"el-icon-edit",placeholder:"请完善Corn表达式"},model:{value:e.form.taskCorn,callback:function(t){e.$set(e.form,"taskCorn",t)},expression:"form.taskCorn"}})],1),t("el-form-item",{staticClass:"sample",attrs:{label:"模型版本",prop:"procXmlId","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"请搜索模型程序"},model:{value:e.form.procXmlId,callback:function(t){e.$set(e.form,"procXmlId",t)},expression:"form.procXmlId"}},e._l(e.verList,(function(e){return t("el-option",{key:e.xmlid,attrs:{label:"V"+e.verseq,value:e.xmlid}})})),1)],1),t("el-form-item",{staticClass:"sample",attrs:{label:"任务类型",prop:"taskType","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"请选择任务类型"},model:{value:e.form.taskType,callback:function(t){e.$set(e.form,"taskType",t)},expression:"form.taskType"}},e._l(e.taskType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{staticClass:"sample",attrs:{label:"数据来源","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"请选择数据来源"},on:{change:e.changeTable},model:{value:e.form.systemCode,callback:function(t){e.$set(e.form,"systemCode",t)},expression:"form.systemCode"}},e._l(e.sourceList,(function(e){return t("el-option",{key:e.systemCode,attrs:{label:e.cnname,value:e.dbname}})})),1)],1),t("el-form-item",{staticClass:"sample",attrs:{label:"数据表","label-width":e.formLabelWidth}},[t("el-autocomplete",{staticClass:"autoinput",attrs:{clearable:"","fetch-suggestions":e.querySearchData,placeholder:"请选择数据表"},on:{select:e.getTableColumn},model:{value:e.form.tableName,callback:function(t){e.$set(e.form,"tableName",t)},expression:"form.tableName"}})],1),t("el-form-item",{staticClass:"sample",attrs:{label:"筛选条件","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:e.form.taskConditionType,callback:function(t){e.$set(e.form,"taskConditionType",t)},expression:"form.taskConditionType"}},e._l(e.filterList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),3==e.form.taskConditionType?t("el-form-item",{attrs:{label:"逻辑表达式","label-width":e.formLabelWidth}},[t("el-input",{attrs:{placeholder:" 1 AND 2  AND （3 OR 4 ）"},model:{value:e.form.taskConditionCorn,callback:function(t){e.$set(e.form,"taskConditionCorn",t)},expression:"form.taskConditionCorn"}})],1):e._e(),1==e.form.taskConditionType||2==e.form.taskConditionType||3==e.form.taskConditionType?t("el-form-item",{staticClass:"flexCotent noMb",attrs:{"label-width":e.formLabelWidth}},[t("div",{staticStyle:{flex:"1"}},[e._v("字段")]),t("div",{staticStyle:{width:"150px","text-align":"start"}},[e._v("运算")]),t("div",{staticStyle:{width:"250px","text-align":"start"}},[e._v("值")]),t("div",{staticStyle:{width:"14px","text-align":"start"}})]):e._e(),1==e.form.taskConditionType||2==e.form.taskConditionType||3==e.form.taskConditionType?t("div",e._l(e.form.taskConditionJson,(function(a,i){return t("el-form-item",{key:i+1,staticClass:"flexCotent",attrs:{"label-width":e.formLabelWidth,label:""+(i+1),prop:"taskConditionJson."+i+".value"}},[t("el-autocomplete",{staticClass:"autoinput",attrs:{clearable:"","fetch-suggestions":e.querySearchColumn,placeholder:"请选择字段"},on:{select:function(t){return e.autoColumn(t,i)}},model:{value:a.column,callback:function(t){e.$set(a,"column",t)},expression:"item.column"}}),t("el-select",{staticStyle:{"margin-right":"5px",width:"150px"},attrs:{placeholder:"请选择"},model:{value:a.type,callback:function(t){e.$set(a,"type",t)},expression:"item.type"}},e._l(e.evalList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-input",{staticStyle:{"margin-right":"5px",width:"250px"},attrs:{placeholder:""},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}),t("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.delItem(i)}}})],1)})),1):e._e(),t("el-form-item",{attrs:{label:"","label-width":e.formLabelWidth}},[t("el-button",{attrs:{icon:"el-icon-plus"},on:{click:e.addItem}},[e._v("添加筛选条件")])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelChose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmChose}},[e._v("确 定")])],1),t("el-dialog",{staticClass:"insideDia",attrs:{width:"1300px",title:"选择模型",visible:e.innerVisible,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}},[t("list",{on:{ConfirmSelect:e.ConfirmSelect}})],1)],1)},n=[],r=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"opTab"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,"label-width":"68px"}},[t("el-form-item",{attrs:{label:"模型名称"}},[t("el-autocomplete",{staticClass:"autoinput",attrs:{clearable:"","fetch-suggestions":e.querySearch,placeholder:"请输入模型名称"},on:{select:e.handleSelect},model:{value:e.formInline.proccnname,callback:function(t){e.$set(e.formInline,"proccnname",t)},expression:"formInline.proccnname"}})],1),t("el-form-item",{attrs:{label:"模型类型"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择模型类型"},model:{value:e.formInline.proctype,callback:function(t){e.$set(e.formInline,"proctype",t)},expression:"formInline.proctype"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"创建人"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择创建人"},model:{value:e.formInline.curdutyer,callback:function(t){e.$set(e.formInline,"curdutyer",t)},expression:"formInline.curdutyer"}},e._l(e.creatorOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择状态"},model:{value:e.formInline.state,callback:function(t){e.$set(e.formInline,"state",t)},expression:"formInline.state"}},e._l(e.stateOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"创建时间"}},[t("el-date-picker",{staticClass:"datePicker",attrs:{"picker-options":e.pickerOptions,"unlink-panels":"",clearable:!1,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.formInline.dateRange,callback:function(t){e.$set(e.formInline,"dateRange",t)},expression:"formInline.dateRange"}})],1),t("el-form-item",[t("div",{staticClass:"btnTab"},[t("el-button",{attrs:{type:"primary",size:"medium",loading:e.getLoading},on:{click:e.onSubmit}},[e._v("查询")]),t("el-button",{attrs:{size:"medium"},on:{click:e.resetList}},[e._v("重置")])],1)])],1),t("div",{staticStyle:{color:"red",margin:"5px 0"}},[e._v("（单击对应数据行即可选中）")]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.getLoading,expression:"getLoading"}],ref:"tables",staticClass:"pb15 listTable",attrs:{data:e.list,height:420,"highlight-current-row":"","default-sort":{prop:"createAt",order:"descending"}},on:{"current-change":e.CurrentChange,"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{label:"序号",type:"index",width:"50"}}),t("el-table-column",{attrs:{label:"模型编号",align:"center",width:"310",prop:"procName"}}),t("el-table-column",{attrs:{label:"模型名称",align:"center",prop:"proccnname"}}),t("el-table-column",{attrs:{label:"模型类型",align:"center",prop:"proctype",width:"150"}}),t("el-table-column",{attrs:{label:"创建人",align:"center",prop:"curdutyer"}}),t("el-table-column",{attrs:{label:"创建时间",align:"center",width:"200",prop:"createAt"}}),t("el-table-column",{attrs:{label:"状态",align:"center",width:"100",prop:"state"}}),t("el-table-column",{attrs:{label:"版本号",align:"center",width:"100",prop:"verseq"}})],1),t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],staticStyle:{"text-align":"end"},attrs:{total:e.total,"page-size":e.pageSize,"current-page":e.pageNum},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t},"current-change":e.handleCurrentChange}})],1)])},c=[],m={data(){return{getLoading:!1,typeOptions:[],stateOptions:[],content:null,formInline:{proccnname:"",proctype:"",curdutyer:"",dateRange:"",state:""},boxTitle:"新建模型",Mode:"add",pickerOptions:{shortcuts:[{text:"最近一周",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},total:1,pageNum:1,pageSize:10,deploier:"",list:[],formLabelWidth:"70px",modelNames:[],creatorOptions:[],dialogFormVisible:!1,deleteVisible:!1,dialogDeployVisible:!1,editId:"",copyId:"",tableHeight:window.innerHeight-286,currentRow:null,deleteId:"",form:{proccnname:"",proctype:""}}},methods:{CurrentChange(e){this.currentRow=e,console.log(e),this.$emit("ConfirmSelect",e)},onSubmit(){this.pageNum=1,this.getList()},handleCurrentChange(e){this.pageNum=e,this.getList()},getCondition(){var e=[{column:"isnew",type:"eq",value:"TRUE"},{column:"createAt",type:"orderByDesc",value:"desc"}];return this.formInline.proccnname&&e.push({column:"proccnname",type:"like",value:this.formInline.proccnname}),this.formInline.dateRange&&(this.formInline.dateRange[0]&&e.push({column:"bssj",type:"geTimeYmd",value:Object(s["b"])(this.formInline.dateRange[0])}),this.formInline.dateRange[1]&&e.push({column:"bssj",type:"leTimeYmd",value:Object(s["b"])(this.formInline.dateRange[1])})),this.formInline.state&&e.push({column:"state",type:"eq",value:this.formInline.state}),this.formInline.proctype&&e.push({column:"proctype",type:"eq",value:this.formInline.proctype}),e},getList(){this.getLoading=!0;const e=encodeURIComponent(JSON.stringify(this.getCondition())),t=new URLSearchParams({pageNum:this.pageNum,pageSize:this.pageSize}).toString(),a=`/system/proc/listPage?${t}&condition=${e}`;this.$http.get(a,{}).then(e=>{if(e&&e.code){const{data:t}=e,a=t.records.map(e=>{const t=this.stateOptions.findIndex(t=>t.value==e.state);-1!=t&&(e.state=this.stateOptions[t].label);const a=this.typeOptions.findIndex(t=>t.value==e.proctype);return-1!=a&&(e.proctype=this.typeOptions[a].label),e});this.list=a,this.total=t.total}}).catch(e=>{console.log(e)}).finally(()=>{this.getLoading=!1})},handleSelectionChange(){},goWithDetail(e){this.$service.getProcDetail(e).then(e=>{if(200==e.code){const t=this.typeOptions.findIndex(t=>t.value==e.data.proctype);this.switchGo(t,e.data)}}).catch(e=>{}).finally(this.getLoading=!1)},getTypeValue(e){const t=this.typeOptions.filter(t=>t.label==e);return t[0].value},resetDia(){this.content="",this.form={proccnname:"",proctype:""}},resetList(){this.formInline={proccnname:"",proctype:"",curdutyer:"",dateRange:"",state:""},this.$message({type:"info",message:"已清空查询条件"}),this.getList()},beforeHandleCommand(e,t,a){return{index:e,row:t,command:a}},confirmEdit(){const e={...this.form,remark:this.content,xmlid:this.editId};this.$service.procUpdate(e).then(e=>{200==e.code&&(this.$suc("编辑成功"),this.getList())}).catch(e=>{console.log(e)}).finally(()=>{this.resetDia()})},confirmDeploy(){this.dialogDeployVisible=!1,this.$suc("发布成功"),this.deploier="",this.getList()},goVersion(e){sessionStorage.setItem("id",e.xmlid),sessionStorage.setItem("procName",e.procName),this.$router.push({name:"model-version",params:{id:e.xmlid,procName:e.procName}})},goCustom(e){const t=this.typeOptions.findIndex(t=>t.label==e.proctype);this.switchGo(t,e)},switchGo(e,t){const a=[{key:"id",value:"xmlid"},{key:"procName",value:"procName"},{key:"proccnname",value:"proccnname"}],i=[{key:"xmlId",value:"xmlid"},{key:"procName",value:"procName"},{key:"verseq",value:"verseq"},{key:"proccnname",value:"proccnname"}];switch(e){case 0:a.forEach(e=>{Object(s["j"])(e.key,t[e.value])}),this.$router.push({name:"program-graph",params:{id:t.xmlid,procName:t.procName,proccnname:t.proccnname}});break;case 1:i.forEach(a=>{"procType"==a.key?Object(s["j"])("procType",this.typeOptions[e].value):Object(s["j"])(a.key,t[a.value])}),this.$router.push({name:"custom",params:{xmlId:t.xmlid,procName:t.procName,verseq:t.verseq,proccnname:t.proccnname,procType:this.typeOptions[e].value}});break;case 2:i.forEach(a=>{"procType"==a.key?Object(s["j"])("procType",this.typeOptions[e].value):Object(s["j"])(a.key,t[a.value])}),this.$router.push({name:"custom",params:{xmlId:t.xmlid,procName:t.procName,verseq:t.verseq,proccnname:t.proccnname,procType:this.typeOptions[e].value}});break;default:console.log("route");break}},delete(e){this.deleteId=e.xmlid,this.deleteVisible=!0},confirmDel(){const e=this.list.findIndex(e=>e.xmlid==this.deleteId),t=this.list[e].proctype,a=this.typeOptions.findIndex(e=>e.label==t),i={id:this.deleteId,procType:a};this.$service.procDel(i).then(e=>{e&&200==e.code&&(this.$suc("删除成功"),this.getList())}).catch(e=>{console.error(e)}),this.deleteVisible=!1},getDir(){const e=JSON.parse(localStorage.getItem("Dictionary")),t=JSON.parse(localStorage.getItem("DictionaryVal"));let a=e.filter(e=>"模型类型"==e.dicName);a=a[0],this.typeOptions=t.filter(e=>e.dicCode==a.dicCode);let i=e.filter(e=>"模型状态"==e.dicName);i=i[0],this.stateOptions=t.filter(e=>e.dicCode==i.dicCode)},getProcCNameList(){this.$service.getProcCNameList().then(e=>{e&&200===e.code&&(this.modelNames=e.data.map(e=>({value:e})))})},querySearch(e,t){var a=this.modelNames,i=e?a.filter(this.createFilter(e)):a;t(i)},createFilter(e){return t=>0===t.value.toLowerCase().indexOf(e.toLowerCase())},handleSelect(e){const{value:t}=e;this.formInline.proccnname=t}},created(){this.getDir(),this.getProcCNameList()},mounted(){this.getList(),this.$nextTick(()=>{})},updated(){this.$nextTick(()=>{})}},d=m,p=(a("7aa3"),a("0c7c")),u=Object(p["a"])(d,r,c,!1,null,"033a0bee",null),h=u.exports,f={components:{list:h},props:{},data(){return{form:{taskConditionJson:[{column:"",type:"",value:""}],procName:"",systemCode:"",tableName:"",taskCorn:"",dataType:"",procXmlId:"",taskConditionCorn:"",taskConditionType:"",taskDescription:"",taskId:"",taskName:"",taskStatus:"",taskType:""},rules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"},{min:2,max:150,message:"长度在 2 到 150 个字符",trigger:"blur"}],procName:[{required:!0,message:"请选择模型",trigger:"change"}],taskCorn:[{required:!0,message:"请完善Corn表达式",trigger:"blur"},{min:2,max:150,message:"长度在 2 到 150 个字符",trigger:"blur"}],procXmlId:[{required:!0,message:"请选择模型版本",trigger:"change"}],taskType:[{required:!0,message:"请选择任务类型",trigger:"change"}]},sourceList:[],taskType:[],modelNames:[],innerVisible:!1,tablefileList:[],columnList:[],filterList:[],evalList:[],verList:[],checkList:[],dialogFormVisible:!1,formLabelWidth:"120px",activeName:"first",radio:3,checkItem:[],dialogData:{title:"",content:"",visible:!1,type:"add"}}},created(){this.getProcCNameList()},mounted(){this.getMetaDbWithTable(),this.getFilterList()},methods:{getFilterList(){const e=JSON.parse(localStorage.getItem("DictionaryVal"));let t=e.filter(e=>"ct"==e.dicCode);this.filterList=t.map(e=>({label:e.label,value:e.value})),console.log("11111111111",this.filterList);let a=e.filter(e=>"op"==e.dicCode);this.evalList=a.map(e=>({label:e.label,value:e.value}));let i=e.filter(e=>"ty"==e.dicCode);this.taskType=i.map(e=>({label:e.label,value:e.value}))},ConfirmSelect(e){console.log(e),this.innerVisible=!1,this.form.procName=e.proccnname,this.form.procXmlId=e.xmlid,this.getVersion(e.procName,"")},getVersion(e,t){this.getLoading=!0;var a=[{column:"procName",type:"eq",value:e},{column:"xmlid",type:"eq",value:t}];a=encodeURIComponent(JSON.stringify(a));const i=new URLSearchParams({pageNum:1,pageSize:99}).toString(),l=`/system/proc/listPage?${i}&condition=${a}`;this.$http.get(l,{}).then(e=>{e&&200==e.code&&(console.log(e.data.records),this.verList=e.data.records)}).catch(e=>{console.log(e)}).finally(()=>{})},getMetaDbWithTable(){this.$service.getMetaDbWithTable().then(e=>{if(200==e.code){console.log(e);const{data:t}=e;this.sourceList=t}else this.$message({type:"error",message:"选项值获取失败"})}).catch(e=>{console.error(e)})},getTableColumn(e){console.log(e);const t={xmlId:e?e.id:""};this.$service.getTableColumn(t).then(e=>{200==e.code?this.columnList=e.data.map(e=>({name:e.colname,value:e.colcnname})):this.$message({type:"error",message:"字段获取失败"})}).catch(e=>{console.error(e)})},autoColumn(e,t){this.form.taskConditionJson[t].columnId=e.name},querySearchData(e,t){var a=this.tablefileList,i=e?a.filter(this.createFilter(e)):a;t(i)},querySearchColumn(e,t){var a=this.columnList,i=e?a.filter(this.createFilter(e)):a;t(i)},createFilter(e){return t=>0===t.value.toLowerCase().indexOf(e.toLowerCase())},changeTable(e){let t=this.sourceList.filter(t=>t.dbname==e);console.log(t),t.length?this.tablefileList=t[0].tablefileList.map(e=>({value:e.dataname,id:e.xmlid})):this.tablefileList=[]},startDia(e){this.resetForm(),this.dialogData=e,this.form={...this.form,...e.content},e.content.taskConditionJson&&(this.form.taskConditionJson=JSON.parse(e.content.taskConditionJson)),"edit"===e.type&&(this.getVersion("",e.content.procXmlId),this.changeTable(e.content.systemCode),this.getTableColumn({id:this.tablefileList.find(t=>t.value===e.content.tableName).id}),this.querySearchData())},resetForm(){this.form={taskConditionJson:[{column:"",type:"",value:"",columnId:""}],systemCode:"",tableName:"",procName:"",dataType:"",procXmlId:"",taskConditionCorn:"",taskConditionType:"",taskDescription:"",taskId:"",taskName:"",taskStatus:"",taskType:""}},addItem(){this.form.taskConditionJson.push({column:"",type:"",value:"",columnId:""}),this.$nextTick(()=>{document.querySelector(".el-dialog__body").scrollTo({top:document.querySelector(".el-form").offsetHeight})})},delItem(e){this.form.taskConditionJson.splice(e,1)},confirmChose(){this.$refs["ruleForm"].validate(e=>{if(!e)return this.$message.error("请正确填写表单信息"),!1;{this.dialogData.visible=!1;let e=this.tablefileList.findIndex(e=>e.xmlid==this.form.tableName);this.tablefileList[e]&&(this.form.tableName=this.tablefileList[e].dataname),this.form["dataType"]=this.form.systemCode,this.form.taskConditionJson&&this.form.taskConditionJson.length&&this.form.taskConditionJson.forEach(e=>{e.column=e.columnId}),this.$emit("confirmChose",this.form,this.dialogData.type),this.resetForm()}})},cancelChose(){this.dialogData.visible=!1,this.resetForm()},getProcCNameList(){this.$service.getProcCNameList().then(e=>{e&&200===e.code&&(this.modelNames=e.data.map(e=>({value:e})))})}}},g=f,b=(a("aa9e"),Object(p["a"])(g,o,n,!1,null,"45b3587e",null)),k=b.exports,y=(a("365c"),{data(){return{getLoading:!1,filterOption:[{label:"无条件执行",value:1},{label:"满足所有条件（AND）",value:2},{label:"满足任意条件（OR）",value:3},{label:"满足自定义逻辑",value:4}],typeOptions:[],carTypeOptions:[{value:"suv",label:"suv"}],stateOptions:[],editorOption:{modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block","image"]]},placeholder:"请输入模型描述"},formInline:{proccnname:"",proctype:"",taskType:"",taskName:"",curdutyer:"",dateRange:"",state:""},boxTitle:"新建任务",Mode:"add",pickerOptions:{shortcuts:[{text:"最近一周",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},total:1,pageNum:1,pageSize:10,deleteVisible:!1,list:[],formLabelWidth:"70px",modelNames:[],taskNames:[],creatorOptions:[],taskOptions:[],taskTypes:[],dialogFormVisible:!1,editId:"",copyId:"",delId:"",tableHeight:window.innerHeight-286,form:{proccnname:"",proctype:""}}},components:{addTask:k},computed:{taskTy(e){return function(e){const t=this.taskTypes.findIndex(t=>t.value==e.taskType);if(t>-1)return this.taskTypes[t].label}},taskSt(e){return function(e){const t=this.taskOptions.findIndex(t=>t.value==e.taskStatus);return this.taskOptions[t].label}}},methods:{onSubmit(){this.pageNum=1,this.getList()},handleCurrentChange(e){this.pageNum=e,this.getList()},getCondition(){var e=[];return this.formInline.proccnname&&e.push({column:"procCName",type:"like",value:this.formInline.proccnname}),this.formInline.dateRange&&(this.formInline.dateRange[0]&&e.push({column:"bssj",type:"geTimeYmd",value:Object(s["b"])(this.formInline.dateRange[0])}),this.formInline.dateRange[1]&&e.push({column:"bssj",type:"leTimeYmd",value:Object(s["b"])(this.formInline.dateRange[1])})),this.formInline.state&&e.push({column:"state",type:"eq",value:this.formInline.state}),this.formInline.proctype&&e.push({column:"proctype",type:"eq",value:this.formInline.proctype}),e},getList(){this.getLoading=!0;let e={pageNum:this.pageNum,pageSize:this.pageSize};this.formInline.proccnname&&(e["procCName"]=this.formInline.proccnname),this.formInline.dateRange&&(this.formInline.dateRange[0]&&(e["startTime"]=Object(s["b"])(this.formInline.dateRange[0])),this.formInline.dateRange[1]&&(e["endTime"]=Object(s["b"])(this.formInline.dateRange[1]))),this.formInline.state&&(e["taskStatus"]=this.formInline.state),this.formInline.taskName&&(e["taskName"]=this.formInline.taskName),this.formInline.taskType&&(e["taskType"]=this.formInline.taskType),this.formInline.proctype&&(e["procType"]=this.formInline.proctype),this.formInline.curdutyer&&(e["createUserName"]=this.formInline.curdutyer),this.$service.taskList(e).then(e=>{if(e&&200===e.code){const{data:t}=e;this.list=t.records,this.total=t.total}}).catch(e=>{console.log(e)}).finally(()=>{this.getLoading=!1})},del(e,t){this.delId=e.taskId,this.deleteVisible=!0},confirmDel(){this.deleteVisible=!1,this.$service.taskDel({id:this.delId}).then(e=>{200==e.code?(this.$suc("删除成功"),this.getList()):this.$message.error("删除失败")}).catch(e=>{console.log(e)}).finally(()=>{})},handleSelectionChange(){},confirm(e,t){let a={dataType:"",procXmlId:"",taskConditionCorn:"",taskConditionDto:[{}],taskConditionType:"",taskDescription:"",taskId:"",taskName:"",taskStatus:"",taskType:""};e={...a,...e},e.taskConditionJson=JSON.stringify(e.taskConditionJson),delete e.createAt,delete e.updateAt,"add"===t?this.$service.taskAdd(e).then(e=>{200===e.code?(this.$suc("新增成功"),this.getList()):this.$message.error("新增失败")}).catch(e=>{console.log(e)}).finally(()=>{}):this.$service.taskUpdate(e).then(e=>{200===e.code?(this.$suc("编辑成功"),this.getList()):this.$message.error("编辑失败")}).catch(e=>{console.log(e)}).finally(()=>{})},goWithDetail(e){this.$service.getProcDetail(e).then(e=>{if(200==e.code){const t=this.typeOptions.findIndex(t=>t.value==e.data.proctype);this.switchGo(t,e.data)}}).catch(e=>{}).finally(this.getLoading=!1)},addNew(){const e={title:"新建任务",visible:!0,type:"add",content:{}};this.$refs.addTask.startDia(e)},edit(e){const t={title:"编辑任务",visible:!0,type:"edit",content:e};this.$refs.addTask.startDia(t)},getTypeValue(e){const t=this.typeOptions.filter(t=>t.label==e);return t[0].value},resetDia(){this.form={proccnname:"",proctype:""}},resetList(){this.formInline={proccnname:"",proctype:"",taskType:"",taskName:"",curdutyer:"",dateRange:"",state:""},this.$message({type:"info",message:"已清空查询条件"}),this.getList()},beforeHandleCommand(e,t,a){return{index:e,row:t,command:a}},handleCommand(e){switch(e.command){case"a":this.goHistory(e.row);break;case"b":this.goResult(e.row);break;case"d":this.goVersion(e.row);break;case"c":this.exeTask(e.row);break}},goResult(e){this.$route.push({name:"result-chart",params:{itemA:e}})},confirmEdit(){const e={...this.form,xmlid:this.editId};this.$service.procUpdate(e).then(e=>{200==e.code&&(this.$suc("编辑成功"),this.getList())}).catch(e=>{console.log(e)}).finally(()=>{this.resetDia()})},goVersion(e){sessionStorage.setItem("id",e.xmlid),sessionStorage.setItem("procName",e.procName),this.$router.push({name:"model-version",params:{id:e.xmlid,procName:e.procName}})},goCustom(e){const t=this.typeOptions.findIndex(t=>t.label==e.proctype);this.switchGo(t,e)},goHistory(e){this.$router.push({name:"task-history",params:{taskId:e.taskId}})},switchGo(e,t){this.$router.push({name:"task-info",params:{data:t}})},getDir(){const e=JSON.parse(localStorage.getItem("Dictionary")),t=JSON.parse(localStorage.getItem("DictionaryVal"));let a=e.filter(e=>"模型类型"==e.dicName);a=a[0],this.typeOptions=t.filter(e=>e.dicCode==a.dicCode);let i=e.filter(e=>"模型状态"==e.dicName);i=i[0],this.stateOptions=t.filter(e=>e.dicCode==i.dicCode);let l=e.filter(e=>"任务状态"==e.dicName);l=l[0],this.taskOptions=t.filter(e=>e.dicCode==l.dicCode);let s=e.filter(e=>"任务类型"==e.dicName);s=s[0],this.taskTypes=t.filter(e=>e.dicCode==s.dicCode)},getProcCNameList(){this.$service.getProcCNameList().then(e=>{e&&200===e.code&&(this.modelNames=e.data.map(e=>({value:e})))})},getTaskNameList(){this.$service.getTaskNameList().then(e=>{e&&200===e.code&&(this.taskNames=e.data.map(e=>({value:e})))})},querySearch(e,t){var a=this.modelNames,i=e?a.filter(this.createFilter(e)):a;t(i)},querySearchTask(e,t){var a=this.taskNames,i=e?a.filter(this.createFilter(e)):a;t(i)},createFilter(e){return t=>0===t.value.toLowerCase().indexOf(e.toLowerCase())},handleSelect(e){const{value:t}=e;this.formInline.proccnname=t},handleSelectTask(e){const{value:t}=e;this.formInline.taskName=t},startOrStopTask(e){const{taskId:t,taskStatus:a}=e,i={taskId:t,taskStatus:"1"===a?"0":"1"};this.$service.taskStartOrStop(i).then(e=>{200===e.code?(this.$suc("操作成功"),this.getList()):this.$message.error("操作失败")}).catch(e=>{console.log(e)}).finally(()=>{})},exeTask(e){this.$service.executeTask({taskId:e.taskId}).then(e=>{200===e.code?(this.$suc("操作成功"),this.getList()):this.$message.error("操作失败")}).catch(e=>{console.log(e)}).finally(()=>{})}},created(){this.getDir(),this.getProcCNameList(),this.getTaskNameList()},mounted(){this.getList(),this.$nextTick(()=>{const e=["ca-header","main-content-footer","blank","el-form demo-form-inline ","breadCrumb"];this.tableHeight=Object(s["c"])(e)-40-20})},updated(){this.$nextTick(()=>{const e=["ca-header","main-content-footer","btnTT","el-form demo-form-inline ","breadCrumb"];this.tableHeight=Object(s["c"])(e)-40-10})}}),v=y,C=(a("2caf"),Object(p["a"])(v,i,l,!1,null,"55cb39c6",null));t["default"]=C.exports}}]);