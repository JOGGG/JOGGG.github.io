import{c as _,i as $e,f as A,g as se,n as $,h as G,j,u as Ie,k as Ce,l as X,o as ye,p as Te,H as re,q as Se,s as p,t as ce,m as Fe,v as Ne,x as Z,L as xe,y as J,z as He,w as Q,A as pe,C as ee,D as Le,E as Ue,F as je,G as te,P as Ye,J as ze}from"./index-c283c009.js";import{d as M,A as w,X as Ke,c as u,O,G as L,M as ke,m as we,F as Ge,r as qe,Y as ne}from"./_plugin-vue_export-helper-730fb40d.js";import{a as Je,T as Xe}from"./index-8c773b25.js";import{C as De}from"./index-dcaaa29e.js";import{F as Qe}from"./index-05cf4729.js";import{F as q}from"./index-89266303.js";import{B as de}from"./index-2cf3f23e.js";const[We,E,me]=_("picker"),Oe=e=>e.find(t=>!t.disabled)||e[0];function Ze(e,t){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(t.children in n)return"cascade"}return"default"}function ie(e,t){t=se(t,0,e.length);for(let n=t;n<e.length;n++)if(!e[n].disabled)return n;for(let n=t-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ve=(e,t,n)=>t!==void 0&&!!e.find(s=>s[n.value]===t);function ue(e,t,n){const s=e.findIndex(v=>v[n.value]===t),a=ie(e,s);return e[a]}function et(e,t,n){const s=[];let a={[t.children]:e},v=0;for(;a&&a[t.children];){const r=a[t.children],h=n.value[v];if(a=$e(h)?ue(r,h,t):void 0,!a&&r.length){const f=Oe(r)[t.value];a=ue(r,f,t)}v++,s.push(r)}return s}function tt(e){const{transform:t}=window.getComputedStyle(e),n=t.slice(7,t.length-1).split(", ")[5];return Number(n)}function nt(e){return A({text:"text",value:"value",children:"children"},e)}const fe=200,he=300,at=15,[Be,ae]=_("picker-column"),Ve=Symbol(Be);var lt=M({name:Be,props:{value:$,fields:G(Object),options:j(),readonly:Boolean,allowHtml:Boolean,optionHeight:G(Number),swipeDuration:G($),visibleOptionNum:G($)},emits:["change","clickOption"],setup(e,{emit:t,slots:n}){let s,a,v,r,h;const f=w(),l=w(),c=w(0),C=w(0),g=Ie(),T=()=>e.options.length,P=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,D=m=>{const y=ie(e.options,m),o=-y*e.optionHeight,i=()=>{const x=e.options[y][e.fields.value];x!==e.value&&t("change",x)};s&&o!==c.value?h=i:i(),c.value=o},B=()=>e.readonly||!e.options.length,Y=m=>{s||B()||(h=null,C.value=fe,D(m),t("clickOption",e.options[m]))},I=m=>se(Math.round(-m/e.optionHeight),0,T()-1),F=(m,y)=>{const o=Math.abs(m/y);m=c.value+o/.003*(m<0?-1:1);const i=I(m);C.value=+e.swipeDuration,D(i)},N=()=>{s=!1,C.value=0,h&&(h(),h=null)},d=m=>{if(!B()){if(g.start(m),s){const y=tt(l.value);c.value=Math.min(0,y-P())}C.value=0,a=c.value,v=Date.now(),r=a,h=null}},S=m=>{if(B())return;g.move(m),g.isVertical()&&(s=!0,Te(m,!0)),c.value=se(a+g.deltaY.value,-(T()*e.optionHeight),e.optionHeight);const y=Date.now();y-v>he&&(v=y,r=c.value)},b=()=>{if(B())return;const m=c.value-r,y=Date.now()-v;if(y<he&&Math.abs(m)>at){F(m,y);return}const i=I(c.value);C.value=fe,D(i),setTimeout(()=>{s=!1},0)},V=()=>{const m={height:`${e.optionHeight}px`};return e.options.map((y,o)=>{const i=y[e.fields.text],{disabled:x}=y,K=y[e.fields.value],z={role:"button",style:m,tabindex:x?-1:0,class:[ae("item",{disabled:x,selected:K===e.value}),y.className],onClick:()=>Y(o)},Me={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:i};return u("li",z,[n.option?n.option(y):u("div",Me,null)])})};return Ce(Ve),X({stopMomentum:N}),Ke(()=>{const m=e.options.findIndex(i=>i[e.fields.value]===e.value),o=-ie(e.options,m)*e.optionHeight;c.value=o}),ye("touchmove",S,{target:f}),()=>u("div",{ref:f,class:ae(),onTouchstartPassive:d,onTouchend:b,onTouchcancel:b},[u("ul",{ref:l,style:{transform:`translate3d(0, ${c.value+P()}px, 0)`,transitionDuration:`${C.value}ms`,transitionProperty:C.value?"all":"none"},class:ae("wrapper"),onTransitionend:N},[V()])])}});const[ot]=_("picker-toolbar"),W={title:String,cancelButtonText:String,confirmButtonText:String},st=["cancel","confirm","title","toolbar"],ct=Object.keys(W);var Pe=M({name:ot,props:W,emits:["confirm","cancel"],setup(e,{emit:t,slots:n}){const s=()=>{if(n.title)return n.title();if(e.title)return u("div",{class:[E("title"),"van-ellipsis"]},[e.title])},a=()=>t("cancel"),v=()=>t("confirm"),r=()=>{const f=e.cancelButtonText||me("cancel");return u("button",{type:"button",class:[E("cancel"),re],onClick:a},[n.cancel?n.cancel():f])},h=()=>{const f=e.confirmButtonText||me("confirm");return u("button",{type:"button",class:[E("confirm"),re],onClick:v},[n.confirm?n.confirm():f])};return()=>u("div",{class:E("toolbar")},[n.toolbar?n.toolbar():[r(),s(),h()]])}});const[Ee,le]=_("picker-group"),Ae=Symbol(Ee),it=A({tabs:j(),nextStepText:String},W);M({name:Ee,props:it,emits:["confirm","cancel"],setup(e,{emit:t,slots:n}){const s=w(0),{children:a,linkChildren:v}=Se(Ae);v();const r=()=>s.value<e.tabs.length-1&&e.nextStepText,h=()=>{r()?s.value++:t("confirm",a.map(l=>l.confirm()))},f=()=>t("cancel");return()=>{var l;const c=(l=n.default)==null?void 0:l.call(n),C=r()?e.nextStepText:e.confirmButtonText;return u("div",{class:le()},[u(Pe,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:C,onConfirm:h,onCancel:f},null),u(Je,{active:s.value,"onUpdate:active":g=>s.value=g,class:le("tabs"),shrink:!0,animated:!0},{default:()=>[e.tabs.map((g,T)=>u(Xe,{title:g,titleClass:le("tab-title")},{default:()=>[c==null?void 0:c[T]]}))]})])}}});const _e=A({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:p(44),showToolbar:ce,swipeDuration:p(1e3),visibleOptionNum:p(6)},W),ut=A({},_e,{columns:j(),modelValue:j(),toolbarPosition:Fe("top"),columnsFieldNames:Object});var rt=M({name:We,props:ut,emits:["confirm","cancel","change","clickOption","update:modelValue"],setup(e,{emit:t,slots:n}){const s=w(),a=w(e.modelValue.slice(0)),{parent:v}=Ce(Ae),{children:r,linkChildren:h}=Se(Ve);h();const f=O(()=>nt(e.columnsFieldNames)),l=O(()=>Ne(e.optionHeight)),c=O(()=>Ze(e.columns,f.value)),C=O(()=>{const{columns:o}=e;switch(c.value){case"multiple":return o;case"cascade":return et(o,f.value,a);default:return[o]}}),g=O(()=>C.value.some(o=>o.length)),T=O(()=>C.value.map((o,i)=>ue(o,a.value[i],f.value))),P=O(()=>C.value.map((o,i)=>o.findIndex(x=>x[f.value.value]===a.value[i]))),D=(o,i)=>{if(a.value[o]!==i){const x=a.value.slice(0);x[o]=i,a.value=x}},B=()=>({selectedValues:a.value.slice(0),selectedOptions:T.value,selectedIndexes:P.value}),Y=(o,i)=>{D(i,o),c.value==="cascade"&&a.value.forEach((x,K)=>{const z=C.value[K];ve(z,x,f.value)||D(K,z.length?z[0][f.value.value]:void 0)}),t("change",A({columnIndex:i},B()))},I=(o,i)=>t("clickOption",A({columnIndex:i,currentOption:o},B())),F=()=>{r.forEach(i=>i.stopMomentum());const o=B();return ke(()=>{t("confirm",o)}),o},N=()=>t("cancel",B()),d=()=>C.value.map((o,i)=>u(lt,{value:a.value[i],fields:f.value,options:o,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:l.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:x=>Y(x,i),onClickOption:x=>I(x,i)},{option:n.option})),S=o=>{if(g.value){const i={height:`${l.value}px`},x={backgroundSize:`100% ${(o-l.value)/2}px`};return[u("div",{class:E("mask"),style:x},null),u("div",{class:[He,E("frame")],style:i},null)]}},b=()=>{const o=l.value*+e.visibleOptionNum,i={height:`${o}px`};return u("div",{ref:s,class:E("columns"),style:i},[d(),S(o)])},V=()=>{if(e.showToolbar&&!v)return u(Pe,we(J(e,ct),{onConfirm:F,onCancel:N}),J(n,st))};L(C,o=>{o.forEach((i,x)=>{i.length&&!ve(i,a.value[x],f.value)&&D(x,Oe(i)[f.value.value])})},{immediate:!0});let m;return L(()=>e.modelValue,o=>{!Z(o,a.value)&&!Z(o,m)&&(a.value=o.slice(0))},{deep:!0}),L(a,o=>{Z(o,e.modelValue)||(m=o.slice(0),t("update:modelValue",m))},{immediate:!0}),ye("touchmove",Te,{target:s}),X({confirm:F,getSelectedOptions:()=>T.value}),()=>{var o,i;return u("div",{class:E()},[e.toolbarPosition==="top"?V():null,e.loading?u(xe,{class:E("loading")},null):null,(o=n["columns-top"])==null?void 0:o.call(n),b(),(i=n["columns-bottom"])==null?void 0:i.call(n),e.toolbarPosition==="bottom"?V():null])}}});const U="000000",dt=["title","cancel","confirm","toolbar","columns-top","columns-bottom"],mt=["title","loading","readonly","optionHeight","swipeDuration","visibleOptionNum","cancelButtonText","confirmButtonText"],R=(e="",t=U,n=void 0)=>({text:e,value:t,children:n});function vt({areaList:e,columnsNum:t,columnsPlaceholder:n}){const{city_list:s={},county_list:a={},province_list:v={}}=e,r=t>1,h=t>2,f=()=>{if(r)return n.length?[R(n[0],U,h?[]:void 0)]:[]},l=new Map;Object.keys(v).forEach(g=>{l.set(g.slice(0,2),R(v[g],g,f()))});const c=new Map;if(r){const g=()=>{if(h)return n.length?[R(n[1])]:[]};Object.keys(s).forEach(T=>{const P=R(s[T],T,g());c.set(T.slice(0,4),P);const D=l.get(T.slice(0,2));D&&D.children.push(P)})}h&&Object.keys(a).forEach(g=>{const T=c.get(g.slice(0,4));T&&T.children.push(R(a[g],g))});const C=Array.from(l.values());if(n.length){const g=h?[R(n[2])]:void 0,T=r?[R(n[1],U,g)]:void 0;C.unshift(R(n[0],U,T))}return C}const ft=Q(rt),[ht,gt]=_("area"),bt=A({},_e,{modelValue:String,columnsNum:p(3),columnsPlaceholder:j(),areaList:{type:Object,default:()=>({})}});var Ct=M({name:ht,props:bt,emits:["change","confirm","cancel","update:modelValue"],setup(e,{emit:t,slots:n}){const s=w([]),a=w(),v=O(()=>vt(e)),r=(...l)=>t("change",...l),h=(...l)=>t("cancel",...l),f=(...l)=>t("confirm",...l);return L(s,l=>{const c=l.length?l[l.length-1]:"";c&&c!==e.modelValue&&t("update:modelValue",c)},{deep:!0}),L(()=>e.modelValue,l=>{if(l){const c=s.value.length?s.value[s.value.length-1]:"";l!==c&&(s.value=[`${l.slice(0,2)}0000`,`${l.slice(0,4)}00`,l].slice(0,+e.columnsNum))}else s.value=[]},{immediate:!0}),X({confirm:()=>{var l;return(l=a.value)==null?void 0:l.confirm()},getSelectedOptions:()=>{var l;return((l=a.value)==null?void 0:l.getSelectedOptions())||[]}}),()=>u(ft,we({ref:a,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,class:gt(),columns:v.value,onChange:r,onCancel:h,onConfirm:f},J(e,mt)),J(n,dt))}});const yt=Q(Ct),[Tt,oe]=_("switch"),St={size:$,loading:Boolean,disabled:Boolean,modelValue:ee,activeColor:String,inactiveColor:String,activeValue:{type:ee,default:!0},inactiveValue:{type:ee,default:!1}};var xt=M({name:Tt,props:St,emits:["change","update:modelValue"],setup(e,{emit:t,slots:n}){const s=()=>e.modelValue===e.activeValue,a=()=>{if(!e.disabled&&!e.loading){const r=s()?e.inactiveValue:e.activeValue;t("update:modelValue",r),t("change",r)}},v=()=>{if(e.loading){const r=s()?e.activeColor:e.inactiveColor;return u(xe,{class:oe("loading"),color:r},null)}if(n.node)return n.node()};return pe(()=>e.modelValue),()=>{var r;const{size:h,loading:f,disabled:l,activeColor:c,inactiveColor:C}=e,g=s(),T={fontSize:Le(h),backgroundColor:g?c:C};return u("div",{role:"switch",class:oe({on:g,loading:f,disabled:l}),style:T,tabindex:l?void 0:0,"aria-checked":g,onClick:a},[u("div",{class:oe("node")},[v()]),(r=n.background)==null?void 0:r.call(n)])}}});const kt=Q(xt),[wt,ge]=_("address-edit-detail"),be=_("address-edit")[2];var Dt=M({name:wt,props:{show:Boolean,rows:$,value:String,rules:Array,focused:Boolean,maxlength:$,searchResult:Array,showSearchResult:Boolean},emits:["blur","focus","input","selectSearch"],setup(e,{emit:t}){const n=w(),s=()=>e.focused&&e.searchResult&&e.showSearchResult,a=l=>{t("selectSearch",l),t("input",`${l.address||""} ${l.name||""}`.trim())},v=()=>{if(!s())return;const{searchResult:l}=e;return l.map(c=>u(De,{clickable:!0,key:(c.name||"")+(c.address||""),icon:"location-o",title:c.name,label:c.address,class:ge("search-item"),border:!1,onClick:()=>a(c)},null))},r=l=>t("blur",l),h=l=>t("focus",l),f=l=>t("input",l);return()=>{if(e.show)return u(Ge,null,[u(q,{autosize:!0,clearable:!0,ref:n,class:ge(),rows:e.rows,type:"textarea",rules:e.rules,label:be("addressDetail"),border:!s(),maxlength:e.maxlength,modelValue:e.value,placeholder:be("addressDetail"),onBlur:r,onFocus:h,"onUpdate:modelValue":f},null),v()])}}});const[Ot,H,k]=_("address-edit"),Re={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,addressDetail:""},Bt={areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:ce,showDetail:ce,showDelete:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:$,showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:p(1),detailMaxlength:p(200),areaColumnsPlaceholder:j(),addressInfo:{type:Object,default:()=>A({},Re)},telValidator:{type:Function,default:Ue}};var Vt=M({name:Ot,props:Bt,emits:["save","focus","delete","clickArea","changeArea","changeDetail","selectSearch","changeDefault"],setup(e,{emit:t,slots:n}){const s=w(),a=qe({}),v=w(!1),r=w(!1),h=O(()=>je(e.areaList)&&Object.keys(e.areaList).length),f=O(()=>{const{province:d,city:S,county:b,areaCode:V}=a;if(V){const m=[d,S,b];return d&&d===S&&m.splice(1,1),m.filter(Boolean).join("/")}return""}),l=O(()=>{var d;return((d=e.searchResult)==null?void 0:d.length)&&r.value}),c=d=>{r.value=d==="addressDetail",t("focus",d)},C=O(()=>{const{validator:d,telValidator:S}=e,b=(V,m)=>({validator:y=>{if(d){const o=d(V,y);if(o)return o}return y?!0:m}});return{name:[b("name",k("nameEmpty"))],tel:[b("tel",k("telInvalid")),{validator:S,message:k("telInvalid")}],areaCode:[b("areaCode",k("areaEmpty"))],addressDetail:[b("addressDetail",k("addressEmpty"))]}}),g=()=>t("save",a),T=d=>{a.addressDetail=d,t("changeDetail",d)},P=d=>{a.province=d[0].text,a.city=d[1].text,a.county=d[2].text},D=({selectedValues:d,selectedOptions:S})=>{d.some(b=>b===U)?ze(k("areaEmpty")):(v.value=!1,P(S),t("changeArea",S))},B=()=>t("delete",a),Y=d=>{a.areaCode=d||""},I=()=>{setTimeout(()=>{r.value=!1})},F=d=>{a.addressDetail=d},N=()=>{if(e.showSetDefault){const d={"right-icon":()=>u(kt,{modelValue:a.isDefault,"onUpdate:modelValue":S=>a.isDefault=S,onChange:S=>t("changeDefault",S)},null)};return ne(u(De,{center:!0,title:k("defaultAddress"),class:H("default")},d),[[te,!l.value]])}};return X({setAreaCode:Y,setAddressDetail:F}),L(()=>e.addressInfo,d=>{A(a,Re,d),ke(()=>{var S;const b=(S=s.value)==null?void 0:S.getSelectedOptions();b&&b.every(V=>V&&V.value!==U)&&P(b)})},{deep:!0,immediate:!0}),()=>{const{disableArea:d}=e;return u(Qe,{class:H(),onSubmit:g},{default:()=>{var S;return[u("div",{class:H("fields")},[u(q,{modelValue:a.name,"onUpdate:modelValue":b=>a.name=b,clearable:!0,label:k("name"),rules:C.value.name,placeholder:k("name"),onFocus:()=>c("name")},null),u(q,{modelValue:a.tel,"onUpdate:modelValue":b=>a.tel=b,clearable:!0,type:"tel",label:k("tel"),rules:C.value.tel,maxlength:e.telMaxlength,placeholder:k("tel"),onFocus:()=>c("tel")},null),ne(u(q,{readonly:!0,label:k("area"),"is-link":!d,modelValue:f.value,rules:C.value.areaCode,placeholder:e.areaPlaceholder||k("area"),onFocus:()=>c("areaCode"),onClick:()=>{t("clickArea"),v.value=!d}},null),[[te,e.showArea]]),u(Dt,{show:e.showDetail,rows:e.detailRows,rules:C.value.addressDetail,value:a.addressDetail,focused:r.value,maxlength:e.detailMaxlength,searchResult:e.searchResult,showSearchResult:e.showSearchResult,onBlur:I,onFocus:()=>c("addressDetail"),onInput:T,onSelectSearch:b=>t("selectSearch",b)},null),(S=n.default)==null?void 0:S.call(n)]),N(),ne(u("div",{class:H("buttons")},[u(de,{block:!0,round:!0,type:"primary",text:e.saveButtonText||k("save"),class:H("button"),loading:e.isSaving,nativeType:"submit"},null),e.showDelete&&u(de,{block:!0,round:!0,class:H("button"),loading:e.isDeleting,text:e.deleteButtonText||k("delete"),onClick:B},null)]),[[te,!l.value]]),u(Ye,{show:v.value,"onUpdate:show":b=>v.value=b,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[u(yt,{modelValue:a.areaCode,"onUpdate:modelValue":b=>a.areaCode=b,ref:s,loading:!h.value,areaList:e.areaList,columnsPlaceholder:e.areaColumnsPlaceholder,onConfirm:D,onCancel:()=>{v.value=!1}},null)]})]}})}}});const It=Q(Vt);export{It as A};
