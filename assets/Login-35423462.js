import{ao as k,ap as C,aq as x}from"./index-c283c009.js";import"./index-8c6623a3.js";/* empty css              *//* empty css              *//* empty css              */import{s as S}from"./SimpleHeader-f2f1910e.js";import{A as v,r as w,Q as $,o as c,a as f,a2 as m,c as r,a0 as d,a7 as y}from"./_plugin-vue_export-helper-730fb40d.js";import{l as B,r as N}from"./user-1997260e.js";import{m as P}from"./md5-e36d655b.js";import{F as T}from"./index-89266303.js";import{B as U}from"./index-2cf3f23e.js";import{F}from"./index-05cf4729.js";import"./index-dcaaa29e.js";import"./use-id-278a301c.js";const I={class:"img-verify"},L=["width","height"],h={__name:"VueImageVerify",setup(b,{expose:u}){const t=v(null),s=w({pool:"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",width:120,height:40,imgCode:""});u({state:s}),$(()=>{s.imgCode=i()});const p=()=>{s.imgCode=i()},a=(e,n)=>parseInt(Math.random()*(n-e)+e),l=(e,n)=>{const o=a(e,n),g=a(e,n),_=a(e,n);return`rgb(${o},${g},${_})`},i=()=>{const e=t.value.getContext("2d");e.fillStyle=l(180,230),e.fillRect(0,0,s.width,s.height);let n="";for(let o=0;o<4;o++){const g=s.pool[a(0,s.pool.length)];n+=g;const _=a(18,40),V=a(-30,30);e.font=_+"px Simhei",e.textBaseline="top",e.fillStyle=l(80,150),e.save(),e.translate(30*o+15,15),e.rotate(V*Math.PI/180),e.fillText(g,-15+5,-15),e.restore()}for(let o=0;o<5;o++)e.beginPath(),e.moveTo(a(0,s.width),a(0,s.height)),e.lineTo(a(0,s.width),a(0,s.height)),e.strokeStyle=l(180,230),e.closePath(),e.stroke();for(let o=0;o<40;o++)e.beginPath(),e.arc(a(0,s.width),a(0,s.height),1,0,2*Math.PI),e.closePath(),e.fillStyle=l(150,200),e.fill();return n};return(e,n)=>(c(),f("div",I,[m("canvas",{ref_key:"verify",ref:t,width:s.width,height:s.height,onClick:p},null,8,L)]))}};const M={class:"login"},q=m("img",{class:"logo",src:"https://s.yezgea02.com/1604045825972/newbee-mall-vue3-app-logo.png",alt:""},null,-1),R={key:0,class:"login-body login"},z={style:{margin:"16px"}},A={key:1,class:"login-body register"},D={style:{margin:"16px"}},te={__name:"Login",setup(b){const u=v(null),t=w({username:"",password:"",username1:"",password1:"",type:"login",imgCode:"",verify:""}),s=a=>{t.type=a,t.verify=""},p=async a=>{if(t.imgCode=u.value.state.imgCode||"",t.verify.toLowerCase()!=t.imgCode.toLowerCase()){k("验证码有误");return}if(t.type=="login"){const{data:l}=await B({loginName:a.username,passwordMd5:P(a.password)});C("token",l),window.location.href="/"}else await N({loginName:a.username1,password:a.password1}),x("注册成功"),t.type="login",t.verify=""};return(a,l)=>{const i=T,e=U,n=F;return c(),f("div",M,[r(S,{name:a.type=="login"?"登录":"注册",back:"/home"},null,8,["name"]),q,t.type=="login"?(c(),f("div",R,[r(n,{onSubmit:p},{default:d(()=>[r(i,{modelValue:t.username,"onUpdate:modelValue":l[0]||(l[0]=o=>t.username=o),name:"username",label:"用户名",placeholder:"用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),r(i,{modelValue:t.password,"onUpdate:modelValue":l[1]||(l[1]=o=>t.password=o),type:"password",name:"password",label:"密码",placeholder:"密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"]),r(i,{center:"",clearable:"",label:"验证码",placeholder:"输入验证码",modelValue:t.verify,"onUpdate:modelValue":l[2]||(l[2]=o=>t.verify=o)},{button:d(()=>[r(h,{ref_key:"verifyRef",ref:u},null,512)]),_:1},8,["modelValue"]),m("div",z,[m("div",{class:"link-register",onClick:l[3]||(l[3]=o=>s("register"))},"立即注册"),r(e,{round:"",block:"",color:"#1baeae","native-type":"submit"},{default:d(()=>[y("登录")]),_:1})])]),_:1})])):(c(),f("div",A,[r(n,{onSubmit:p},{default:d(()=>[r(i,{modelValue:t.username1,"onUpdate:modelValue":l[4]||(l[4]=o=>t.username1=o),name:"username1",label:"用户名",placeholder:"用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),r(i,{modelValue:t.password1,"onUpdate:modelValue":l[5]||(l[5]=o=>t.password1=o),type:"password",name:"password1",label:"密码",placeholder:"密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"]),r(i,{center:"",clearable:"",label:"验证码",placeholder:"输入验证码",modelValue:t.verify,"onUpdate:modelValue":l[6]||(l[6]=o=>t.verify=o)},{button:d(()=>[r(h,{ref_key:"verifyRef",ref:u},null,512)]),_:1},8,["modelValue"]),m("div",D,[m("div",{class:"link-login",onClick:l[7]||(l[7]=o=>s("login"))},"已有登录账号"),r(e,{round:"",block:"",color:"#1baeae","native-type":"submit"},{default:d(()=>[y("注册")]),_:1})])]),_:1})]))])}}};export{te as default};
