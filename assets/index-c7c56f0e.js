import{c as w,s as k,m as U,t as F,ab as B,l as G,o as R,a8 as _,ac as I,L as V,w as y,n as Y,u as Q,ad as X,p as j}from"./index-895aba94.js";import{u as q}from"./index-68a0f58b.js";import{d as C,A as P,G as $,ad as z,Q as J,c as r,M as A,r as K}from"./_plugin-vue_export-helper-730fb40d.js";const[O,T,W]=w("list"),Z={error:Boolean,offset:k(300),loading:Boolean,disabled:Boolean,finished:Boolean,errorText:String,direction:U("down"),loadingText:String,finishedText:String,immediateCheck:F};var p=C({name:O,props:Z,emits:["load","update:error","update:loading"],setup(e,{emit:d,slots:i}){const l=P(e.loading),f=P(),v=P(),h=q(),a=B(f),o=()=>{A(()=>{if(l.value||e.finished||e.disabled||e.error||(h==null?void 0:h.value)===!1)return;const{offset:n,direction:g}=e,u=_(a);if(!u.height||I(f))return;let m=!1;const D=_(v);g==="up"?m=u.top-D.top<=n:m=D.bottom-u.bottom<=n,m&&(l.value=!0,d("update:loading",!0),d("load"))})},H=()=>{if(e.finished){const n=i.finished?i.finished():e.finishedText;if(n)return r("div",{class:T("finished-text")},[n])}},x=()=>{d("update:error",!1),o()},E=()=>{if(e.error){const n=i.error?i.error():e.errorText;if(n)return r("div",{role:"button",class:T("error-text"),tabindex:0,onClick:x},[n])}},c=()=>{if(l.value&&!e.finished&&!e.disabled)return r("div",{class:T("loading")},[i.loading?i.loading():r(V,{class:T("loading-icon")},{default:()=>[e.loadingText||W("loading")]})])};return $(()=>[e.loading,e.finished,e.error],o),h&&$(h,n=>{n&&o()}),z(()=>{l.value=e.loading}),J(()=>{e.immediateCheck&&o()}),G({check:o}),R("scroll",o,{target:a,passive:!0}),()=>{var n;const g=(n=i.default)==null?void 0:n.call(i),u=r("div",{ref:v,class:T("placeholder")},null);return r("div",{ref:f,role:"feed",class:T(),"aria-busy":l.value},[e.direction==="down"?g:u,c(),H(),E(),e.direction==="up"?g:u])}}});const re=y(p),[ee,b,te]=w("pull-refresh"),M=50,ae=["pulling","loosing","success"],ne={disabled:Boolean,modelValue:Boolean,headHeight:k(M),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:Y,successDuration:k(500),animationDuration:k(300)};var se=C({name:ee,props:ne,emits:["change","refresh","update:modelValue"],setup(e,{emit:d,slots:i}){let l;const f=P(),v=P(),h=B(f),a=K({status:"normal",distance:0,duration:0}),o=Q(),H=()=>{if(e.headHeight!==M)return{height:`${e.headHeight}px`}},x=()=>a.status!=="loading"&&a.status!=="success"&&!e.disabled,E=t=>{const s=+(e.pullDistance||e.headHeight);return t>s&&(t<s*2?t=s+(t-s)/2:t=s*1.5+(t-s*2)/4),Math.round(t)},c=(t,s)=>{const S=+(e.pullDistance||e.headHeight);a.distance=t,s?a.status="loading":t===0?a.status="normal":t<S?a.status="pulling":a.status="loosing",d("change",{status:a.status,distance:t})},n=()=>{const{status:t}=a;return t==="normal"?"":e[`${t}Text`]||te(t)},g=()=>{const{status:t,distance:s}=a;if(i[t])return i[t]({distance:s});const S=[];return ae.includes(t)&&S.push(r("div",{class:b("text")},[n()])),t==="loading"&&S.push(r(V,{class:b("loading")},{default:n})),S},u=()=>{a.status="success",setTimeout(()=>{c(0)},+e.successDuration)},m=t=>{l=X(h.value)===0,l&&(a.duration=0,o.start(t))},D=t=>{x()&&m(t)},N=t=>{if(x()){l||m(t);const{deltaY:s}=o;o.move(t),l&&s.value>=0&&o.isVertical()&&(j(t),c(E(s.value)))}},L=()=>{l&&o.deltaY.value&&x()&&(a.duration=+e.animationDuration,a.status==="loosing"?(c(+e.headHeight,!0),d("update:modelValue",!0),A(()=>d("refresh"))):c(0))};return $(()=>e.modelValue,t=>{a.duration=+e.animationDuration,t?c(+e.headHeight,!0):i.success||e.successText?u():c(0,!1)}),R("touchmove",N,{target:v}),()=>{var t;const s={transitionDuration:`${a.duration}ms`,transform:a.distance?`translate3d(0,${a.distance}px, 0)`:""};return r("div",{ref:f,class:b()},[r("div",{ref:v,class:b("track"),style:s,onTouchstartPassive:D,onTouchend:L,onTouchcancel:L},[r("div",{class:b("head"),style:H()},[g()]),(t=i.default)==null?void 0:t.call(i)])])}}});const ce=y(se);export{re as L,ce as P};
